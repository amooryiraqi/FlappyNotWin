<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Rocket Game</title>
  <style>
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
      touch-action: none;
      overscroll-behavior: none;
      background: black;
    }
    .game {
      width: 100%;
      height: 100%;
      position: relative;
      background: url('background.jpg') repeat-x center center;
      background-size: cover;
      animation: none;
    }
    .scrolling {
      animation: scrollBackground 10s linear infinite;
    }
    @keyframes scrollBackground {
      from { background-position-x: 0; }
      to { background-position-x: -1000px; }
    }
    .player {
      position: absolute;
      width: 15vw;
      height: 15vw;
      max-width: 80px;
      max-height: 80px;
      background: url('flappy.png') no-repeat center center;
      background-size: contain;
      top: 50%;
      left: 15vw;
      z-index: 2;
      transform: translateY(-50%) rotate(0deg);
      transition: transform 0.1s linear;
    }
    .pipe {
      position: absolute;
      width: 12vw;
      max-width: 100px;
      background: url('pipe.png') repeat-y center center;
      background-size: 100% auto;
      z-index: 1;
    }
    .pipe-top {
      top: 0;
    }
    .pipe-bottom {
      bottom: 0;
    }
    .scoreboard {
      position: absolute;
      top: 2vw;
      left: 2vw;
      color: white;
      font-size: 5vw;
      background: rgba(0, 0, 0, 0.5);
      padding: 2vw 4vw;
      border-radius: 8px;
      z-index: 10;
    }
    .retry-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 3vw 6vw;
      font-size: 5vw;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      z-index: 20;
      display: none;
    }
  </style>
</head>
<body>
  <div class="game" id="game">
    <div class="scoreboard" id="scoreboard">Tap to start</div>
    <div class="player" id="player"></div>
    <button class="retry-button" id="retryBtn">Retry</button>
  </div>

  <script>
    const game = document.getElementById('game');
    const player = document.getElementById('player');
    const scoreboard = document.getElementById('scoreboard');
    const retryBtn = document.getElementById('retryBtn');

    let score = 0;
    let highScore = localStorage.getItem('highScore') || 0;
    let started = false;
    let gameOverFlag = false;

    let x = player.offsetLeft;
    let y = window.innerHeight / 2 - player.offsetHeight / 2;
    let vy = 0;
    let gravity = 0.4;
    const thrust = -9;
    let gravityTimer = 0;

    const pipes = [];
    let frame = 0;
    const pipeSpeed = 5;

    function startGame() {
      if (!started) {
        started = true;
        game.classList.add('scrolling');
        gameLoop();
        scoreboard.textContent = `Score: ${score} | High Score: ${highScore}`;
      }
      vy = thrust;
      gravityTimer = 0;
    }

    document.addEventListener('keydown', (e) => {
      if (e.code === 'ArrowUp' || e.code === 'Space') {
        startGame();
      }
    });

    game.addEventListener('touchstart', () => {
      if (!started) startGame();
      else {
        vy = thrust;
        gravityTimer = 0;
      }
    });

    retryBtn.addEventListener('click', () => {
      location.reload();
    });

    function spawnPipe() {
      const gap = 220;
      const minHeight = 50;
      const maxHeight = window.innerHeight - gap - 100;
      const topHeight = Math.floor(Math.random() * (maxHeight - minHeight)) + minHeight;
      const bottomHeight = window.innerHeight - topHeight - gap;

      const pipeTop = document.createElement('div');
      pipeTop.className = 'pipe pipe-top';
      pipeTop.style.height = `${topHeight}px`;
      pipeTop.style.left = `${window.innerWidth}px`;

      const pipeBottom = document.createElement('div');
      pipeBottom.className = 'pipe pipe-bottom';
      pipeBottom.style.height = `${bottomHeight}px`;
      pipeBottom.style.left = `${window.innerWidth}px`;

      game.appendChild(pipeTop);
      game.appendChild(pipeBottom);

      pipes.push({ top: pipeTop, bottom: pipeBottom, x: window.innerWidth, passed: false });
    }

    function updatePlayer() {
      gravityTimer++;
      gravity = 0.4 + 0.01 * gravityTimer;
      vy += gravity;
      y += vy;

      if (y < 0) y = 0;
      if (y > window.innerHeight - player.offsetHeight) handleGameOver("You fell!");

      player.style.top = y + 'px';
      player.style.left = x + 'px';
      let angle = Math.max(-25, Math.min(90, vy * 3));
      player.style.transform = `translateY(-50%) rotate(${angle}deg)`;
    }

    function checkCollision(a, b) {
      const aRect = a.getBoundingClientRect();
      const bRect = b.getBoundingClientRect();
      return !(
        aRect.top > bRect.bottom ||
        aRect.bottom < bRect.top ||
        aRect.right < bRect.left ||
        aRect.left > bRect.right
      );
    }

    function updatePipes() {
      pipes.forEach(pipe => {
        pipe.x -= pipeSpeed;
        pipe.top.style.left = `${pipe.x}px`;
        pipe.bottom.style.left = `${pipe.x}px`;

        if (!pipe.passed && pipe.x + pipe.offsetWidth < x) {
          score++;
          pipe.passed = true;
        }

        if (checkCollision(player, pipe.top) || checkCollision(player, pipe.bottom)) {
          handleGameOver("You hit a pipe!");
        }
      });
    }

    function handleGameOver(message) {
      if (gameOverFlag) return;
      gameOverFlag = true;
      game.classList.remove('scrolling');
      retryBtn.style.display = 'block';
      if (score > highScore) {
        localStorage.setItem('highScore', score);
      }
      scoreboard.textContent = `${message} | Final Score: ${score} | High Score: ${highScore}`;
    }

    function gameLoop() {
      if (!started || gameOverFlag) return;
      updatePlayer();
      updatePipes();

      if (frame % 120 === 0) spawnPipe();

      if (score > highScore) {
        highScore = score;
        localStorage.setItem('highScore', highScore);
      }

      scoreboard.textContent = `Score: ${score} | High Score: ${highScore}`;
      frame++;
      requestAnimationFrame(gameLoop);
    }

    player.style.left = x + 'px';
    player.style.top = y + 'px';
  </script>
</body>
</html>
